<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - OMAN SERVERS</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Press Start 2P', cursive;
    margin: 0;
    background: black;
    color: #00ff00;
    text-align: center;
    overflow-x: hidden;
}
canvas#bgCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
}
header {
    background-color: #111;
    border-bottom: 2px solid #00ff00;
    padding: 20px 0;
}
header h1 { font-size: 22px; margin: 0; }
main { padding: 20px; max-width: 1200px; margin: auto; }
input, select, textarea, button {
    font-family: 'Press Start 2P', cursive;
    margin: 5px 0;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #00ff00;
    background: black;
    color: #00ff00;
    display: block;
    width: 60%;
    margin-left: auto;
    margin-right: auto;
}
button { cursor: pointer; background: #00ff00; color: black; font-weight: bold; }
button:hover { opacity: 0.8; }
.server-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
.server {
    background: rgba(0,0,0,0.85);
    border: 2px solid #00ff00;
    padding: 10px;
    border-radius: 8px;
    width: 450px; /* wider card for long addresses */
    text-align: center;
    word-wrap: break-word;
}
.server img { width: 150px; height: 150px; object-fit: cover; margin-bottom: 5px; }
textarea { height: 60px; }
.stats, .activity-log, .admin-message, .quick-links { 
    border: 2px solid #00ff00; 
    border-radius: 8px; 
    padding: 10px; 
    margin: 20px auto; 
    max-width: 600px;
}
#searchInput { margin-bottom: 20px; width: 80%; padding: 8px; border-radius: 5px; border: 1px solid #00ff00; background: black; color: #00ff00; }
.copy-btn, .toggle-btn, .edit-btn, .remove-btn { margin-top:5px; padding:5px 8px; border:none; border-radius:5px; background:#00ff00; color:black; cursor:pointer; }
.copy-btn:hover, .toggle-btn:hover, .edit-btn:hover, .remove-btn:hover { background:#00cc00; }
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<header><h1>Admin Panel - OMAN SERVERS</h1></header>

<main>
<input type="text" id="searchInput" placeholder="Search servers by name...">

<div class="add-server">
<h3>Add New Server</h3>

<label>Server Name</label>
<input type="text" id="newName" placeholder="Enter server name">

<label>Address</label>
<input type="text" id="newAddr" placeholder="Enter server address">

<label>Port</label>
<input type="text" id="newPort" placeholder="Optional port">

<label>Type</label>
<select id="newVerType">
<option value="">Select type</option>
<option value="Java">Java</option>
<option value="Bedrock">Bedrock</option>
</select>

<label>Status</label>
<select id="newStatus">
<option value="Online">Online</option>
<option value="Offline">Offline</option>
</select>

<label>Version</label>
<input type="text" id="newVersion" placeholder="Server version">

<label>Description</label>
<textarea id="newDesc" placeholder="Enter server description"></textarea>

<label>Server Picture</label>
<input type="file" id="newImgFile" accept="image/*">

<button onclick="addServer()">Add Server</button>
</div>

<div class="server-list" id="server-list"></div>

<div class="stats" id="stats"></div>

<div class="quick-links">
<h3>Quick Links</h3>
<button onclick="openPage('editserver.html')">Edit Server</button>
<button onclick="openPage('removeserver.html')">Remove Server</button>
<button onclick="openPage('setstatus.html')">Set Status</button>
</div>

<div class="admin-message">
<h3>Admin Notes</h3>
<textarea id="adminNotes" placeholder="Write notes..." style="height:80px;"></textarea>
<button onclick="saveNotes()">Save Notes</button>
</div>

<div class="activity-log" id="activityLog"><h3>Activity Log</h3></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD_LtDCU_fI1LazKYuuFBHf4tC_pzHAiCw",
  authDomain: "omanwebsite-ae60c.firebaseapp.com",
  projectId: "omanwebsite-ae60c",
  storageBucket: "omanwebsite-ae60c.appspot.com",
  messagingSenderId: "554330436845",
  appId: "1:554330436845:web:5e9e90857410848ee488e4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const password="0021";
if(prompt("Enter admin password:")!==password){
    document.body.innerHTML="<h2 style='color:red;margin-top:50px;'>Access Denied</h2>";
}

const serverList=document.getElementById('server-list');
const searchInput=document.getElementById('searchInput');
let servers=[];

// Fetch servers from Firestore
function fetchServers() {
    db.collection('servers').get().then(snapshot=>{
        servers=[];
        snapshot.forEach(doc=>{
            servers.push({...doc.data(), id: doc.id});
        });
        renderServers(searchInput.value);
        updateStats();
    });
}

// Render servers
function renderServers(filter=""){
    serverList.innerHTML="";
    servers.filter(s=>s.name.toLowerCase().includes(filter.toLowerCase())).forEach((s,i)=>{
        const div=document.createElement('div');
        div.className='server';
        const statusColor = s.status==='Online' ? 'blue' : 'red';
        div.innerHTML=`
            <h4>${s.name}</h4>
            <div style="color:${statusColor}; font-weight:bold;">Status: ${s.status}</div>
            <img src="${s.img}">
            <input value="${s.addr}">
            <input value="${s.port}">
            <select>
                <option ${s.verType==='Java'?'selected':''}>Java</option>
                <option ${s.verType==='Bedrock'?'selected':''}>Bedrock</option>
            </select>
            <input value="${s.version}">
            <textarea>${s.desc}</textarea>
            <button class="copy-btn" onclick="copyAddr('${s.addr}','${s.port}')">Copy Address</button>
            <button class="toggle-btn" onclick="toggleStatus('${s.id}')">Toggle Status</button>
        `;
        serverList.appendChild(div);
    });
}

// Add server
function addServer(){
    const name=document.getElementById('newName').value;
    const addr=document.getElementById('newAddr').value;
    const port=document.getElementById('newPort').value;
    const verType=document.getElementById('newVerType').value;
    const status=document.getElementById('newStatus').value;
    const version=document.getElementById('newVersion').value;
    const desc=document.getElementById('newDesc').value;
    const fileInput=document.getElementById('newImgFile');
    if(!name||!addr||!verType||!status||!version||!desc||fileInput.files.length===0){alert('Please fill all fields and choose an image');return;}
    const reader=new FileReader();
    reader.onload=function(e){
        db.collection('servers').add({
            name, addr, port, verType, status, version, desc, img:e.target.result
        }).then(()=>{
            fetchServers();
            alert('Server added!');
            document.getElementById('newName').value='';
            document.getElementById('newAddr').value='';
            document.getElementById('newPort').value='';
            document.getElementById('newVerType').value='';
            document.getElementById('newStatus').value='Online';
            document.getElementById('newVersion').value='';
            document.getElementById('newDesc').value='';
            document.getElementById('newImgFile').value='';
        });
    };
    reader.readAsDataURL(fileInput.files[0]);
}

function copyAddr(addr,port){navigator.clipboard.writeText(addr+(port?':'+port:''));alert('Address copied');}
function toggleStatus(id){
    const server=servers.find(s=>s.id===id);
    if(!server) return;
    const newStatus = server.status==='Online'?'Offline':'Online';
    db.collection('servers').doc(id).update({status:newStatus}).then(fetchServers);
}

function openPage(url){window.location.href=url;}
function saveNotes(){db.collection('admin').doc('notes').set({text:document.getElementById('adminNotes').value});alert('Notes saved!');}
function updateStats(){
    const stats=document.getElementById('stats');
    const total=servers.length;
    const online=servers.filter(s=>s.status==='Online').length;
    const offline=servers.filter(s=>s.status==='Offline').length;
    const javaCount=servers.filter(s=>s.verType==='Java').length;
    const bedCount=servers.filter(s=>s.verType==='Bedrock').length;
    stats.innerHTML=`<h3>Statistics</h3>Total: ${total} | Online: ${online} | Offline: ${offline} | Java: ${javaCount} | Bedrock: ${bedCount}`;
}

// Load notes
db.collection('admin').doc('notes').get().then(doc=>{
    if(doc.exists) document.getElementById('adminNotes').value=doc.data().text||'';
});

searchInput.addEventListener('input',()=>renderServers(searchInput.value));
fetchServers();

// Matrix background animation
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()";
const fontSize = 14;
const columns = Math.floor(canvas.width / fontSize);
const drops = Array(columns).fill(1);
function drawMatrix(){
    ctx.fillStyle = "rgba(0,0,0,0.05)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#00ff00";
    ctx.font = fontSize + "px monospace";
    for(let i=0;i<drops.length;i++){
        const text = letters.charAt(Math.floor(Math.random()*letters.length));
        ctx.fillText(text, i*fontSize, drops[i]*fontSize);
        drops[i]++;
        if(drops[i]*fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
    }
}
setInterval(drawMatrix, 50);
window.addEventListener('resize', () => {canvas.width = window.innerWidth; canvas.height = window.innerHeight;});
</script>

</body>
</html>
